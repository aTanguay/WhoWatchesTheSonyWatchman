# Sony Watchman ESP32 Wiring Guide

**Version**: 1.0
**Last Updated**: 2025-11-06
**Print-Friendly**: Yes (optimized for black & white printing)

---

## Table of Contents
1. [Components List](#components-list)
2. [Tools Required](#tools-required)
3. [Pin Configuration Overview](#pin-configuration-overview)
4. [Detailed Wiring Instructions](#detailed-wiring-instructions)
5. [Power Supply Wiring](#power-supply-wiring)
6. [Testing Procedure](#testing-procedure)
7. [Troubleshooting](#troubleshooting)
8. [Safety Notes](#safety-notes)

---

## Components List

### Required Components

| Component | Specification | Quantity | Notes |
|-----------|--------------|----------|-------|
| **ESP32 Development Board** | ESP32-WROOM-32 or ESP32-DevKitC | 1 | 38-pin version recommended |
| **IPS Display** | ST7789 240x320 2.0" IPS LCD | 1 | SPI interface |
| **MicroSD Card Module** | SPI interface, 3.3V | 1 | Supports FAT32 |
| **MicroSD Card** | Class 10, 32GB | 1 | SanDisk or Samsung recommended |
| **Rotary Encoder** | KY-040 or compatible | 1 | With push button |
| **Audio Amplifier** | MAX98357A (I2S) | 1 | Or PAM8403 (analog) |
| **Speaker** | 8Î© 1-3W | 1 | Original Sony Watchman speaker ideal |
| **18650 Batteries** | 3000mAh or higher | 2 | Protected cells recommended |
| **18650 Battery Holder** | 2-cell series holder | 1 | Wired for series (6-8.4V) |
| **TP4056 Charging Module** | With protection circuit | 2 | One per battery, or 2S version |
| **Buck-Boost Converter** | MT3608 or similar, 3.3V output | 1 | Input: 6-8.4V, Output: 3.3V 2A+ |
| **Voltage Divider Resistors** | 10kÎ© resistors | 2 | For battery voltage sensing |
| **Power Switch** | SPST toggle switch | 1 | Rated for 2A+ |
| **USB-C or Micro USB Port** | For charging | 1 | Matches TP4056 module |

### Optional Components

| Component | Specification | Quantity | Purpose |
|-----------|--------------|----------|---------|
| **Accelerometer** | MPU6050 or ADXL345 | 1 | Shake detection (future feature) |
| **LED Indicators** | 3mm LEDs (red, green) | 2 | Power/charging status |
| **Resistors for LEDs** | 220Î© | 2 | Current limiting |
| **Breadboard** | Half-size | 1 | Initial testing |
| **Jumper Wires** | Male-to-male, male-to-female | 40+ | Prototyping |
| **Perfboard/Protoboard** | 7x9cm or larger | 1 | Permanent assembly |

### Connectors & Hardware

- JST connectors (optional, for modular connections)
- Heat shrink tubing (various sizes)
- Solder and flux
- Double-sided tape or mounting brackets
- M2/M3 screws and standoffs

---

## Tools Required

### Essential Tools
- â˜ Soldering iron (adjustable, 300-400Â°C)
- â˜ Solder (60/40 or lead-free)
- â˜ Wire strippers
- â˜ Flush cutters
- â˜ Multimeter (for testing continuity and voltage)
- â˜ Small Phillips and flathead screwdrivers
- â˜ USB cable (for programming ESP32)

### Helpful Tools
- â˜ Helping hands / PCB holder
- â˜ Desoldering pump or wick
- â˜ Hot glue gun
- â˜ Label maker or tape
- â˜ Tweezers
- â˜ Wire organizers

---

## Pin Configuration Overview

### ESP32 Pin Assignments

```
ESP32-WROOM-32 Pinout (38-pin version)

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    3V3  â”‚ 1               38 â”‚  GND
    EN   â”‚ 2               37 â”‚  GPIO 23  â† MOSI (Display/SD)
    VP   â”‚ 3               36 â”‚  GPIO 22  â† I2S DOUT (Audio)
    VN   â”‚ 4               35 â”‚  TXD0
GPIO 34  â”‚ 5 (ADC)         34 â”‚  RXD0
GPIO 35  â”‚ 6               33 â”‚  GPIO 21
GPIO 32  â”‚ 7 (Enc CLK)     32 â”‚  GPIO 19  â† MISO (SD Card)
GPIO 33  â”‚ 8 (Enc DT)      31 â”‚  GPIO 18  â† SCK (Display/SD)
GPIO 25  â”‚ 9 (I2S WS)      30 â”‚  GPIO 5   â† CS Display
GPIO 26  â”‚10 (I2S BCLK)    29 â”‚  GPIO 17  â† CS SD Card
GPIO 27  â”‚11 (Enc SW)      28 â”‚  GPIO 16  â† DC (Display)
GPIO 14  â”‚12               27 â”‚  GPIO 4   â† RST (Display)
GPIO 12  â”‚13               26 â”‚  GPIO 0
    GND  â”‚14               25 â”‚  GPIO 2
GPIO 13  â”‚15               24 â”‚  GPIO 15  â† BL (Display)
    SD2  â”‚16               23 â”‚  SD1
    SD3  â”‚17               22 â”‚  CMD
    CMD  â”‚18               21 â”‚  CLK
    5V   â”‚19               20 â”‚  GND
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quick Reference Pin Table

| Function | ESP32 Pin | Component Pin | Wire Color Suggestion |
|----------|-----------|---------------|----------------------|
| **Display (SPI)** |
| MOSI | GPIO 23 | SDI/MOSI | Blue |
| SCK | GPIO 18 | SCK/CLK | Yellow |
| CS | GPIO 5 | CS | Orange |
| DC | GPIO 16 | DC/RS | Green |
| RST | GPIO 4 | RESET | White |
| BL | GPIO 15 | BL/LED | Purple |
| **SD Card (SPI)** |
| MISO | GPIO 19 | MISO/DO | Brown |
| MOSI | GPIO 23 | MOSI/DI | Blue (shared) |
| SCK | GPIO 18 | SCK/CLK | Yellow (shared) |
| CS | GPIO 17 | CS | Red |
| **Audio (I2S)** |
| BCLK | GPIO 26 | BCLK | Gray |
| WS (LRCLK) | GPIO 25 | LRC/WS | Pink |
| DOUT | GPIO 22 | DIN | Cyan |
| **Rotary Encoder** |
| CLK (A) | GPIO 32 | CLK | Black |
| DT (B) | GPIO 33 | DT | Brown |
| SW | GPIO 27 | SW | White |
| **Power** |
| Battery Sense | GPIO 34 | Voltage Divider | Red |
| 3.3V | 3V3 | Power | Red |
| GND | GND | Ground | Black |

---

## Detailed Wiring Instructions

### Step 1: Display Wiring (ST7789 240x320)

The display is the most critical component. Wire carefully.

**Display Pin Connections:**

```
ESP32           ST7789 Display
â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GPIO 23  â”€â”€â”€â”€â”€â”€â”€â”€â†’  SDA (MOSI)
GPIO 18  â”€â”€â”€â”€â”€â”€â”€â”€â†’  SCL (SCK)
GPIO 5   â”€â”€â”€â”€â”€â”€â”€â”€â†’  CS
GPIO 16  â”€â”€â”€â”€â”€â”€â”€â”€â†’  DC (Data/Command)
GPIO 4   â”€â”€â”€â”€â”€â”€â”€â”€â†’  RST (Reset)
GPIO 15  â”€â”€â”€â”€â”€â”€â”€â”€â†’  BL (Backlight) *optional
3.3V     â”€â”€â”€â”€â”€â”€â”€â”€â†’  VCC
GND      â”€â”€â”€â”€â”€â”€â”€â”€â†’  GND
```

**Important Notes:**
- **Voltage**: ST7789 is 3.3V only! DO NOT connect to 5V.
- **Backlight**: Some displays have built-in backlight driver. If BL pin exists, connect to GPIO 15 for PWM brightness control. If no BL pin, backlight is always on.
- **Wire Length**: Keep wires as short as possible (< 10cm) for SPI reliability at 40MHz.

**Connection Tips:**
1. Solder wires to display first (it's smaller and more delicate)
2. Use 24-26 AWG solid core wire for breadboard, or stranded for final assembly
3. Test display alone before connecting other components

---

### Step 2: SD Card Module Wiring

The SD card shares SPI bus with display but has separate CS pin.

**SD Card Pin Connections:**

```
ESP32           SD Card Module
â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GPIO 19  â”€â”€â”€â”€â”€â”€â”€â”€â†’  MISO (DO)
GPIO 23  â”€â”€â”€â”€â”€â”€â”€â”€â†’  MOSI (DI)  [shared with display]
GPIO 18  â”€â”€â”€â”€â”€â”€â”€â”€â†’  SCK (CLK)  [shared with display]
GPIO 17  â”€â”€â”€â”€â”€â”€â”€â”€â†’  CS
3.3V     â”€â”€â”€â”€â”€â”€â”€â”€â†’  VCC
GND      â”€â”€â”€â”€â”€â”€â”€â”€â†’  GND
```

**Important Notes:**
- **Voltage**: Most SD modules have onboard 3.3V regulator and work with 5V or 3.3V. Check your module's specs.
- **Card Detect**: If your module has CD (card detect) pin, leave it unconnected (not used in firmware).
- **Shared SPI**: MOSI and SCK are shared with display. Use a breadboard rail or solder multiple wires to same ESP32 pin.

**SD Card Format:**
- Must be formatted as FAT32
- For cards >32GB, use third-party formatting tools (Windows format tool won't allow FAT32 >32GB)

---

### Step 3: Audio Amplifier Wiring (MAX98357A I2S)

**MAX98357A Pin Connections:**

```
ESP32           MAX98357A
â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€
GPIO 26  â”€â”€â”€â”€â”€â”€â”€â”€â†’  BCLK
GPIO 25  â”€â”€â”€â”€â”€â”€â”€â”€â†’  LRC (Word Select)
GPIO 22  â”€â”€â”€â”€â”€â”€â”€â”€â†’  DIN (Data In)
3.3V     â”€â”€â”€â”€â”€â”€â”€â”€â†’  VIN
GND      â”€â”€â”€â”€â”€â”€â”€â”€â†’  GND
             â”Œâ”€â”€â”€â”€â†’  OUT+ â”€â”€â”€â”€â†’ Speaker +
             â””â”€â”€â”€â”€â†’  OUT- â”€â”€â”€â”€â†’ Speaker -
```

**Gain Setting (Optional):**
- MAX98357A has optional gain pins (usually 9dB, 12dB, 15dB)
- Leave unconnected for default 9dB gain
- For louder output, connect gain pin to VIN for 15dB

**Important Notes:**
- MAX98357A is a Class D amplifier - very efficient for battery use
- No external components needed (capacitors built-in)
- Speaker should be 4Î© or 8Î©, 1-3W rating

**Alternative: PAM8403 (Analog Audio)**

If using PAM8403 (cheaper but requires DAC output instead of I2S):

```
ESP32           PAM8403
â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€
GPIO 25  â”€â”€â”€â”€â”€â”€â”€â”€â†’  L-IN (via 10kÎ© resistor)
GPIO 26  â”€â”€â”€â”€â”€â”€â”€â”€â†’  R-IN (via 10kÎ© resistor) [or bridge to L-IN]
3.3V     â”€â”€â”€â”€â”€â”€â”€â”€â†’  VCC
GND      â”€â”€â”€â”€â”€â”€â”€â”€â†’  GND
             â”Œâ”€â”€â”€â”€â†’  L-OUT+ â”€â”€â”€â”€â†’ Speaker +
             â””â”€â”€â”€â”€â†’  L-OUT- â”€â”€â”€â”€â†’ Speaker -
```

Note: Firmware uses I2S by default. For analog output, code changes required.

---

### Step 4: Rotary Encoder Wiring (KY-040)

**Encoder Pin Connections:**

```
ESP32           KY-040 Encoder
â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GPIO 32  â”€â”€â”€â”€â”€â”€â”€â”€â†’  CLK (A phase)
GPIO 33  â”€â”€â”€â”€â”€â”€â”€â”€â†’  DT (B phase)
GPIO 27  â”€â”€â”€â”€â”€â”€â”€â”€â†’  SW (button)
3.3V     â”€â”€â”€â”€â”€â”€â”€â”€â†’  + (VCC)
GND      â”€â”€â”€â”€â”€â”€â”€â”€â†’  GND
```

**Important Notes:**
- KY-040 has onboard pull-up resistors, no external resistors needed
- Some encoders have 5 pins (extra is usually duplicate GND)
- Direction can be swapped if rotation feels backwards (swap CLK/DT in code or wiring)

**Mechanical Mounting:**
- Encoder will mount where original Sony Watchman tuning knob was
- May need shaft adapter/coupler to fit original knob

---

### Step 5: Power Supply Wiring

This is the most complex part. Follow carefully!

#### Battery Configuration

```
2x 18650 Batteries in Series (6.0V - 8.4V)

  [Battery 1]     [Battery 2]
  â”‚+      -â”‚     â”‚+      -â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚             â”‚
       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
          6-8.4V
```

#### Charging Circuit

```
                    â”Œâ”€â”€â”€ USB-C/Micro USB (charging input)
                    â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
              â”‚  TP4056 x2  â”‚  (2S charging module OR 2x 1S modules)
              â”‚  Charge     â”‚
              â”‚  Protection â”‚
              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                6-8.4V
```

#### Voltage Divider (Battery Sensing)

```
Battery +  â”€â”€â”€â”€â”€â”€â”
                 â”‚
               [10kÎ©]  â† R1
                 â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â†’  GPIO 34 (ADC)
                 â”‚
               [10kÎ©]  â† R2
                 â”‚
GND  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Voltage divider ratio: 2:1
Max input to ADC: 4.2V (safe for ESP32's 3.3V ADC with headroom)
```

#### Buck-Boost Converter (3.3V Regulated)

```
Battery  â”€â”€â”€â”€â†’  MT3608 Buck-Boost  â”€â”€â”€â”€â†’  3.3V Out
6-8.4V          (Adjust pot for 3.3V)      â”‚
                                           â””â”€â”€â†’ ESP32 3V3
                                           â””â”€â”€â†’ All 3.3V components
```

**Adjustment Procedure:**
1. Connect battery to input (through power switch)
2. Disconnect ESP32 and all components from output
3. Use multimeter on output
4. Adjust potentiometer until output reads exactly 3.3V
5. Verify with load: connect 100Î© resistor, should still read 3.3V

#### Complete Power Wiring Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Battery 1  â”‚ 4.2V
â”‚  (18650)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ +
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  Battery 2  â”‚ 4.2V          â”‚ 6-8.4V Total
â”‚  (18650)    â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
       â”‚ -                    â”‚
       â”‚                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚  TP4056    â”‚ â† USB charging port
        â”‚  Charger   â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚   Power    â”‚ â† SPST Switch
        â”‚   Switch   â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Voltage Divider â†’ GPIO 34
              â”‚
        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚  MT3608    â”‚
        â”‚ Buck-Boost â”‚
        â”‚ 6-8V â†’ 3.3Vâ”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚ 3.3V
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â†’ ESP32 3V3 pin
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â†’ Display VCC
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â†’ SD Card VCC
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â†’ Encoder VCC
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â†’ Audio Amp VCC
              â”‚
             GND (common ground for all)
```

**Critical Safety Notes:**
- âš ï¸ **DO NOT** connect battery directly to ESP32 (max 3.6V!)
- âš ï¸ Always use protected 18650 cells
- âš ï¸ Double-check polarity before connecting batteries
- âš ï¸ Add a fuse (1-2A) between battery and circuit for extra safety

---

### Step 6: Optional Accelerometer (Future Feature)

If you want shake detection, add MPU6050 or ADXL345:

**MPU6050 Pin Connections:**

```
ESP32           MPU6050
â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€
GPIO 21  â”€â”€â”€â”€â”€â”€â”€â”€â†’  SDA (I2C Data)
GPIO 22  â”€â”€â”€â”€â”€â”€â”€â”€â†’  SCL (I2C Clock)
3.3V     â”€â”€â”€â”€â”€â”€â”€â”€â†’  VCC
GND      â”€â”€â”€â”€â”€â”€â”€â”€â†’  GND
             NC  â†â”€  INT (interrupt, optional)
```

Note: This is not yet implemented in firmware. Reserve these pins for future use.

---

## Complete Wiring Checklist

Print this section and check off as you wire:

### Display (ST7789)
- [ ] GPIO 23 â†’ SDA (MOSI)
- [ ] GPIO 18 â†’ SCL (SCK)
- [ ] GPIO 5 â†’ CS
- [ ] GPIO 16 â†’ DC
- [ ] GPIO 4 â†’ RST
- [ ] GPIO 15 â†’ BL (if available)
- [ ] 3.3V â†’ VCC
- [ ] GND â†’ GND

### SD Card Module
- [ ] GPIO 19 â†’ MISO
- [ ] GPIO 23 â†’ MOSI (shared with display)
- [ ] GPIO 18 â†’ SCK (shared with display)
- [ ] GPIO 17 â†’ CS
- [ ] 3.3V â†’ VCC
- [ ] GND â†’ GND
- [ ] SD card formatted as FAT32
- [ ] Test content on SD card

### Audio (MAX98357A)
- [ ] GPIO 26 â†’ BCLK
- [ ] GPIO 25 â†’ LRC
- [ ] GPIO 22 â†’ DIN
- [ ] 3.3V â†’ VIN
- [ ] GND â†’ GND
- [ ] Speaker connected (8Î©, 1-3W)

### Rotary Encoder (KY-040)
- [ ] GPIO 32 â†’ CLK
- [ ] GPIO 33 â†’ DT
- [ ] GPIO 27 â†’ SW
- [ ] 3.3V â†’ VCC
- [ ] GND â†’ GND

### Power System
- [ ] 2x 18650 batteries in series
- [ ] TP4056 charging module installed
- [ ] Power switch installed
- [ ] Voltage divider (2x 10kÎ©) to GPIO 34
- [ ] Buck-boost converter adjusted to 3.3V
- [ ] 3.3V distributed to all components
- [ ] Common ground verified for all components

---

## Testing Procedure

### Pre-Power Tests (Do These First!)

1. **Visual Inspection**
   - [ ] Check all solder joints for bridges or cold joints
   - [ ] Verify no loose wires
   - [ ] Confirm polarity of batteries and power connections

2. **Continuity Tests** (with multimeter, power OFF)
   - [ ] Check 3.3V rail continuity to all components
   - [ ] Check GND continuity to all components
   - [ ] Verify no shorts between 3.3V and GND
   - [ ] Verify no shorts between signal pins

3. **Resistance Test**
   - [ ] Measure resistance between 3.3V and GND (should be >1kÎ©)

### Power-On Tests

4. **Voltage Tests** (batteries disconnected initially)
   - [ ] Set buck-boost output to exactly 3.3V (use multimeter)
   - [ ] Verify voltage divider outputs ~3.3V with 6.6V input

5. **First Power-On** (ESP32 not yet programmed)
   - [ ] Connect batteries (through switch)
   - [ ] Turn on power switch
   - [ ] Check 3.3V rail voltage (should be 3.25-3.35V)
   - [ ] Check ESP32 board LED (should light up or blink)
   - [ ] Display backlight should turn on (if display has always-on backlight)

6. **Program ESP32**
   - [ ] Connect ESP32 to computer via USB
   - [ ] Flash firmware using `idf.py flash`
   - [ ] Monitor serial output: `idf.py monitor`

7. **Component Tests** (watch serial monitor)
   - [ ] Display initialization message appears
   - [ ] Cyan splash screen appears on display
   - [ ] SD card mount successful message
   - [ ] Battery percentage reported correctly
   - [ ] Channels scanned and found
   - [ ] Video playback starts

8. **Interactive Tests**
   - [ ] Rotate encoder: channel switches, serial log confirms
   - [ ] Press encoder button: video pauses, press again to resume
   - [ ] Long-press encoder: skips to next episode
   - [ ] Audio plays through speaker (confirm sync with video)

---

## Troubleshooting

### Display Issues

**Problem: White/blank screen**
- Check 3.3V power to display (use multimeter)
- Verify all 8 connections (especially MOSI, SCK, CS, DC)
- Check wire lengths (keep < 10cm for SPI reliability)
- Verify display model matches ST7789 (not ST7735 or ILI9341)

**Problem: Garbage/random pixels**
- Wrong display driver in code
- Poor SPI connections (re-solder)
- Electrical interference (add 100nF capacitor near display VCC/GND)

**Problem: Display very dim**
- Backlight not connected or not powered
- Check GPIO 15 connection if using PWM backlight control

### SD Card Issues

**Problem: SD card not detected**
- Verify CS pin (GPIO 17)
- Check SD card is formatted as FAT32
- Try different SD card (some are incompatible)
- Ensure card is fully inserted
- Check MISO connection (often forgotten)

**Problem: Files not found**
- Verify folder structure: /sdcard/channels/channel_XX/
- Check file naming: episode_01.avi, episode_02.avi (zero-padded)
- Confirm files are MJPEG format (see CONTENTGUIDE.MD)

### Audio Issues

**Problem: No audio**
- Check speaker polarity (try reversing if no sound)
- Verify speaker impedance (4-8Î©)
- Check all 3 I2S pins (BCLK, WS, DIN)
- Verify MAX98357A power (3.3V)

**Problem: Audio distorted/crackling**
- Speaker impedance too high or too low
- Adjust gain on MAX98357A (lower gain)
- Check for loose connections
- Verify SD card read speed (use Class 10+ card)

**Problem: Audio out of sync with video**
- This requires firmware tuning (A/V sync parameters)
- Report FPS achieved vs. target 15 FPS
- May need to adjust frame timing in video_player.c

### Encoder Issues

**Problem: Encoder not responding**
- Check 3.3V power to encoder
- Verify all 3 pins (CLK, DT, SW)
- Try rotating slowly and steadily
- Check serial monitor for encoder events

**Problem: Encoder direction backwards**
- Swap CLK and DT pins (either in wiring or code)

**Problem: Encoder too sensitive/skips**
- Check debouncing in firmware (should be handled)
- Try different encoder (KY-040 quality varies)

### Power Issues

**Problem: ESP32 resets/reboots randomly**
- Insufficient current from buck-boost (use 2A+ rated converter)
- Add 470ÂµF-1000ÂµF capacitor across 3.3V rail
- Check battery voltage (charge if <6.5V)

**Problem: Battery drains quickly**
- Measure actual current draw (should be 200-400mA during playback)
- Display brightness too high (adjust in code)
- SD card read issues (fragmented card, slow card)

**Problem: Battery percentage incorrect**
- Check voltage divider resistors (should both be exactly 10kÎ©)
- Verify connection to GPIO 34
- Calibrate in firmware if needed

### General Debugging

**Use Serial Monitor:**
```bash
idf.py -p /dev/ttyUSB0 monitor
```

Watch for:
- Initialization messages from each component
- Heap memory reports (should stay stable)
- Error messages
- Frame rate reports

**Check Logs:**
- "Free heap" should be >100KB
- "Battery: XX%" should match actual charge
- "Found X channels" should match SD card content
- FPS should be 12-15 (target 15)

---

## Common Mistakes to Avoid

âŒ **Connecting 5V to 3.3V components** â†’ Instant damage to ESP32, display, or SD card
âœ… Use only 3.3V regulated power

âŒ **Forgetting common ground** â†’ Nothing works, erratic behavior
âœ… Connect GND from all components together

âŒ **Long/loose SPI wires** â†’ Display flickers, SD card errors
âœ… Keep wires short (<10cm) and secure

âŒ **Wrong CS pins** â†’ Display and SD card conflict
âœ… Display CS = GPIO 5, SD CS = GPIO 17 (different pins!)

âŒ **Reversed battery polarity** â†’ Smoke, fire, damage
âœ… Double-check + and - before connecting

âŒ **Over-tightening screws on ESP32** â†’ Cracks PCB
âœ… Snug but not tight

âŒ **No current limiting for LEDs** â†’ Burn out LEDs or GPIO pins
âœ… Always use 220Î© resistors with LEDs

---

## Safety Notes

### Battery Safety
âš ï¸ **18650 lithium cells can be dangerous if mishandled**

- âœ… Only use protected cells (with built-in protection circuit)
- âœ… Check polarity before connecting (+ and -)
- âœ… Never short-circuit batteries
- âœ… Charge in a safe location (fireproof container recommended)
- âœ… Stop using if battery gets hot, swollen, or damaged
- âœ… Store batteries at 40-60% charge if not using for extended periods

### Soldering Safety
- âœ… Use ventilation (fume extractor or open window)
- âœ… Don't touch iron tip (400Â°C!)
- âœ… Use proper stand for iron
- âœ… Wash hands after soldering (lead exposure)

### Electrical Safety
- âœ… Disconnect power before making wiring changes
- âœ… Check for shorts with multimeter before powering on
- âœ… Add fuse for overcurrent protection
- âœ… Use heat shrink tubing to insulate exposed connections

---

## Next Steps After Wiring

1. **Initial Test** (on breadboard)
   - Verify all components work
   - Test for at least 30 minutes
   - Check for overheating components

2. **Performance Testing**
   - Measure actual FPS achieved
   - Test battery life (aim for 10+ hours)
   - Verify A/V sync quality
   - Test channel switching speed

3. **Physical Integration** (into Sony Watchman case)
   - Carefully disassemble Watchman
   - Plan component layout
   - Create mounting brackets (3D printed or DIY)
   - Route wiring neatly
   - Test fit before final assembly

4. **Final Assembly**
   - Solder permanent connections (replace breadboard)
   - Add strain relief for wires
   - Secure all components
   - Test in case before closing
   - Enjoy your retro mini TV! ğŸ“º

---

## Quick Reference: GPIO Summary

```
Display:   23, 18, 5, 16, 4, 15
SD Card:   19, 23, 18, 17  (shares 23, 18 with display)
Audio:     26, 25, 22
Encoder:   32, 33, 27
Battery:   34 (ADC input only)
Reserved:  21, 22 (I2C for future accelerometer)
```

---

## Revision History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2025-11-06 | Initial release |

---

**Questions or Issues?**
Check TROUBLESHOOTING section above, or see project documentation in PROJECTPLAN.MD and BUILD.MD.

**Good luck with your build! ğŸ”§ğŸ“ºâœ¨**

---

*This guide is part of the Sony Watchman ESP32 Retro Media Player project.*
*For more information, see: [github.com/aTanguay/WhoWatchesTheSonyWatchman](https://github.com/aTanguay/WhoWatchesTheSonyWatchman)*
